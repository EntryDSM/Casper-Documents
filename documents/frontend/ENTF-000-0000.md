# ENTF-000-0000: 사용자 프로필 관리 컴포넌트 (수정됨)

---
## 요약
이 컴포넌트는 사용자 프로필 정보를 표시하고 편집할 수 있는 기능을 제공합니다. 사용자 정보 조회, 수정, 프로필 이미지 업로드 기능을 포함합니다.

---
## 동기
현재 시스템에서는 사용자 프로필 관리 기능이 분산되어 있어, 일관된 사용자 경험을 제공하지 못하고 있습니다. 이 컴포넌트는 프로필 관리 기능을 통합하여 사용자 경험을 개선합니다.

### 목표
- 사용자 프로필 정보 표시
- 프로필 정보 수정 기능 제공
- 프로필 이미지 업로드 및 변경 지원
- 반응형 디자인으로 모바일 환경 지원

### 목표가 아닌 것
- 사용자 인증 기능
- 다른 사용자의 프로필 조회 기능
- 소셜 미디어 연동 기능

---
## 제안

### 기술 설계

컴포넌트 구조:

```
Component
import React, { useState, useEffect } from 'react';
import { Button, TextField, Avatar, Box, Typography, Grid, CircularProgress } from '@mui/material';
import { getUserProfile, updateUserProfile, uploadProfileImage } from '../api/userApi';
import { UserProfile } from '../types/user';
import ImageUploader from './ImageUploader';

const UserProfileComponent: React.FC<UserProfileProps> = ({ userId }) => {
  const [profile, setProfile] = useState<UserProfile | null>(null);
  const [isEditing, setIsEditing] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  
  useEffect(() => {
    const fetchProfile = async () => {
      setIsLoading(true);
      try {
        const data = await getUserProfile(userId);
        setProfile(data);
        setError(null);
      } catch (err) {
        setError('프로필을 불러오는 중 오류가 발생했습니다.');
        console.error(err);
      } finally {
        setIsLoading(false);
      }
    };
    
    fetchProfile();
  }, [userId]);
  
  const handleSave = async (updatedProfile: UserProfile) => {
    setIsLoading(true);
    try {
      await updateUserProfile(userId, updatedProfile);
      setProfile(updatedProfile);
      setIsEditing(false);
      setError(null);
    } catch (err) {
      setError('프로필 저장 중 오류가 발생했습니다.');
      console.error(err);
    } finally {
      setIsLoading(false);
    }
  };
  
  const handleImageUpload = async (file: File) => {
    setIsLoading(true);
    try {
      const imageUrl = await uploadProfileImage(userId, file);
      setProfile(prev => prev ? { ...prev, imageUrl } : null);
      setError(null);
    } catch (err) {
      setError('이미지 업로드 중 오류가 발생했습니다.');
      console.error(err);
    } finally {
      setIsLoading(false);
    }
  };
  
  if (isLoading && !profile) {
    return <CircularProgress />;
  }
  
  if (error && !profile) {
    return <Typography color="error">{error}</Typography>;
  }
  
  if (!profile) {
    return <Typography>프로필을 찾을 수 없습니다.</Typography>;
  }
  
  return (
    <Box sx={{ maxWidth: 600, margin: '0 auto', padding: 3 }}>
      <Grid container spacing={3}>
        <Grid item xs={12} display="flex" justifyContent="center">
          <Avatar
            src={profile.imageUrl}
            alt={profile.name}
            sx={{ width: 120, height: 120 }}
          />
        </Grid>
        
        {isEditing ? (
          <ProfileEditForm 
            profile={profile} 
            onSave={handleSave} 
            onCancel={() => setIsEditing(false)}
            onImageUpload={handleImageUpload}
          />
        ) : (
          <ProfileDisplay 
            profile={profile} 
            onEdit={() => setIsEditing(true)} 
          />
        )}
      </Grid>
    </Box>
  );
};

export default UserProfileComponent;
```

```
Props Interface
interface UserProfileProps {
  userId: string;
}

interface ProfileDisplayProps {
  profile: UserProfile;
  onEdit: () => void;
}

interface ProfileEditFormProps {
  profile: UserProfile;
  onSave: (profile: UserProfile) => void;
  onCancel: () => void;
  onImageUpload: (file: File) => void;
}
```

```
State Interface
interface UserProfileState {
  profile: UserProfile | null;
  isEditing: boolean;
  isLoading: boolean;
  error: string | null;
}
```

API 인터페이스:

```
Function / Parameters / Return Type / Description
getUserProfile / userId: string / Promise<UserProfile> / 사용자 프로필 정보를 가져옵니다.
updateUserProfile / userId: string, profile: UserProfile / Promise<UserProfile> / 사용자 프로필 정보를 업데이트합니다.
uploadProfileImage / userId: string, file: File / Promise<string> / 프로필 이미지를 업로드하고 이미지 URL을 반환합니다.
```

에러 처리:
- API 호출 실패 시 에러 메시지 표시
- 이미지 업로드 실패 시 현재 이미지 유지
- 네트워크 오류 시 재시도 옵션 제공

---
## 검토 설문

### 사용자 경험
- 직관적인 인터페이스로 사용자가 쉽게 프로필을 관리할 수 있습니다.
- 로딩 및 에러 상태가 명확하게 표시됩니다.
- 모바일 환경에서도 최적화된 레이아웃을 제공합니다.

### 성능
- 이미지 업로드 전 최적화로 네트워크 부하 감소
- 컴포넌트 렌더링 최적화로 불필요한 재렌더링 방지
- 필요 시 지연 로딩 적용

### 의존성

```
"@mui/material": "^5.14.0",
"react": "^18.2.0",
"react-dom": "^18.2.0",
"axios": "^1.4.0"
```

### 트러블슈팅
- 프로필 정보 로딩 실패: 네트워크 연결 확인 및 API 서버 상태 점검
- 이미지 업로드 오류: 파일 크기 및 형식 확인, 스토리지 서비스 상태 점검
- 프로필 저장 실패: 입력값 유효성 검증 및 API 오류 메시지 확인

---
## 대안
1. 서버 상태 관리 라이브러리(React Query, SWR) 도입 검토
   - 장점: 캐싱과 상태 관리 간소화, 재시도 로직 내장
   - 단점: 추가적인 학습 비용 및 번들 크기 증가
   
2. 폼 상태 관리를 위한 Formik 또는 React Hook Form 사용 고려
   - 장점: 유효성 검증 및 오류 처리 간소화
   - 단점: 추가 의존성 발생
   
3. 컴포넌트 세분화를 통한 재사용성 향상 방안 검토
   - 장점: 컴포넌트 재사용성 증가, 테스트 용이성 향상
   - 단점: 초기 개발 복잡도 증가

---
## 보안 고려 사항
- 민감한 사용자 정보 전송 시 HTTPS 프로토콜 사용
- 이미지 업로드 시 파일 타입 및 크기 검증으로 보안 취약점 방지
- 토큰 기반 인증을 통한 안전한 API 호출
- 클라이언트 측 입력값 검증으로 XSS 공격 방지
- API 요청 시 CSRF 토큰 추가
